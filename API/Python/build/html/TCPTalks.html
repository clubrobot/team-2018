
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TCP Talks &#8212; documentation Club Robot 1.0</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Components" href="Components.html" />
    <link rel="prev" title="Serial Utils" href="SerialUtils.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Components.html" title="Components"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="SerialUtils.html" title="Serial Utils"
             accesskey="P">précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">documentation Club Robot 1.0</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tcp-talks">
<h1>TCP Talks<a class="headerlink" href="#tcp-talks" title="Lien permanent vers ce titre">¶</a></h1>
<p>TCPTalks est une librairie qui permet la communication entre deux terminales pythons.</p>
<div class="section" id="preambule">
<h2>Preambule<a class="headerlink" href="#preambule" title="Lien permanent vers ce titre">¶</a></h2>
<p>TCP Talks est une librairie utilisé pour faire la liaison entre les arduinos et un ordinateur. Il peux également être utilisé en local pour une utilisation interne à la raspberry.
Cette librairie utilise les librairie <code class="docutils literal"><span class="pre">socket</span></code> et <code class="docutils literal"><span class="pre">pickle</span></code> , l’un pour la communication et l’autre pour la serialisation.
Cette librairie est capable de transférer n’importe quelles données, et même des objects si le destinataire en possède l’architecture.</p>
<p>TCPTalks pour fonctionner à besoin d’une partie client et d’une partie serveur. Cette differenciation est peu importante pour l’utilisation car les deux roles possèdents les même fonctionalités.</p>
<p>Les packets de données sont comme celle de SerialTalks c’est a dire standardisés pour une meilleur utilisation.
Il existe des packets maitre et esclave. Les packets maitres sont destiné à lancer une methode chez le destinataire, alors que les messages esclaves sont destinés à se retrouver dans les listes de données reçu et ne peux donc rien déclancher.</p>
<p>Voici un shema récapitulant la structure des packets transités par cette librairie :</p>
<p>Message <strong>maitre</strong> :</p>
<img alt="_images/tab_tcptalks_1.png" src="_images/tab_tcptalks_1.png" />
<p>Message <strong>esclave</strong> :</p>
<img alt="_images/tab_tcptalks_2.png" src="_images/tab_tcptalks_2.png" />
<ol class="arabic simple">
<li><dl class="first docutils">
<dt><strong>Master Code</strong>:</dt>
<dd>Le Master code permet de faire la difference entre un packet esclave et maitre. Il vaut soit <code class="docutils literal"><span class="pre">b'R'</span></code> (maitre)  soit <code class="docutils literal"><span class="pre">b'A'</span></code> (esclave).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>OP Code</strong></dt>
<dd>L’Op code est très important puisqu’il permet d’explicité la requette. On associe pour chaque requette à executer un Op code. L’Op code n’est pas nessaire pour le message esclave car seul le retcode est utilisé pour identifié à quel requette ce message repond.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>RET Code</strong></dt>
<dd>Le RET code est utile pour les retours d’instructions. En effet si le destinataire a besoin de renvoyé des informations au programme python. il va utilisé ce code dans le packet retour pour permettre au programme python de bien associé avec quel requette ces informations sont reliés.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>args et kwargs</strong>:</dt>
<dd>Une requette peux avoir une infinité d’arguments suplémentaire du moment que la taille n’est pas trop excessif.</dd>
</dl>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Il n’y a pas de TCPUtils car c’est la librairie <code class="docutils literal"><span class="pre">pickle</span></code> qui permet la serialisation et la deserialisation.</p>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Lien permanent vers ce titre">¶</a></h2>
<p>La librairie contient deux objects, TCPTalks et TCPListener. TCPTalks est utile pour lancer les requettes tandis que TCPListener s’occupe de recevoir et traités les messages. Il est donc important de ne pas touché a ce dernier.</p>
<dl class="class">
<dt id="TCPTalks">
<em class="property">class </em><code class="descname">TCPTalks</code><a class="headerlink" href="#TCPTalks" title="Lien permanent vers cette définition">¶</a></dt>
<dd><dl class="method">
<dt id="TCPTalks.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>ip=None</em>, <em>port=25565</em>, <em>password=None</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.__init__" title="Lien permanent vers cette définition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first last simple">
<li><strong>ip</strong> – Permet de choisir de se connecter à un ip ou de se lancé en tant que serveur si égal à  <strong>None</strong>.</li>
<li><strong>port</strong> (<em>int</em>) – Indiquez le port à utilisé pour les communications avec ce TCPtalks. Il est possible de lancer plusieurs TCPTalks du moment que chaqu’un à un port different.</li>
<li><strong>password</strong> – Indiquez le mot de passe a utiliser.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour se connecter à un server sur le même ordinateur utilisez l’IP <code class="docutils literal"><span class="pre">127.0.0.1</span></code></p>
</div>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.__enter__">
<code class="descname">__enter__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.__enter__" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Methode pour l’utilisation de <code class="docutils literal"><span class="pre">with</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Return TCPTalks:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">Retourne l’object de communication connecté.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.__exit__">
<code class="descname">__exit__</code><span class="sig-paren">(</span><em>exc_type</em>, <em>exc_value</em>, <em>traceback</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.__exit__" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Methode pour l’utilisation de <code class="docutils literal"><span class="pre">with</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first last simple">
<li><strong>exc_type</strong> – type de l’erreur</li>
<li><strong>exc_value</strong> – argument d’erreur</li>
<li><strong>traceback</strong> – trace de l’erreur</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.connect">
<code class="descname">connect</code><span class="sig-paren">(</span><em>timeout=5</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.connect" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Lance la connexion du socket avec les renseignements données au constructeur <code class="docutils literal"><span class="pre">__init__</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><p class="first"><strong>timeout</strong> – Timeout à utiliser pour la conexion du socket.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Lève:</th><td class="field-body"><ul class="first last simple">
<li><strong>AlreadyConnectedError</strong> – Dans le cas ou le socket est déjà connecté.</li>
<li><strong>ForeverAloneError</strong> – Dans le cas ou la connexion ne peux s’établir faute de réponse de la part du binome.</li>
<li><strong>AuthentificationError</strong> – Dans le cas d’un mot de passe faux</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.disconnect">
<code class="descname">disconnect</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.disconnect" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Coupe les communications, le socket et le thread TCPListener.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">bind(opcode, instruction):</code></dt>
<dd><p>Bind permet d’associé un Opcode et une fonction ou methode. La cible (instruction) sera executé a chaque fois que l’Op code est recu. La methode selectionner peux renvoyer n’importe quels arguments, il sera automatiquement transmit à l’éméteur de la requette.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first simple">
<li><strong>opcode</strong> – Opcode à utiliser pour la requette</li>
<li><strong>instruction</strong> – Adresse de la fonction a utiliser pour le bind.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Lève:</th><td class="field-body"><p class="first last"><strong>KeyError</strong> – Dans le cas ou l’OpCode est déjà utilisé.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour donner l’adresse d’une méthode, il suffit d’Indiquer son nom. Exemple <code class="docutils literal"><span class="pre">print</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.send">
<code class="descname">send</code><span class="sig-paren">(</span><em>opcode</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.send" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Permet l’envoie d’une requette sans récupérer directement la réponse du binome. Il est recommandé d’utiliser cette methode pour les requettes sans retours, mais permet dans le cas contraire de récupérer la reponse plus tard grace au retcode retourné.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first simple">
<li><strong>opcode</strong> – Code a utilisé pour identifier la requette</li>
<li><strong>args</strong> – Arguments suplémentaire à transmettre.</li>
<li><strong>kwargs</strong> – Arguments suplémentaire à transmettre només.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Retourne:</th><td class="field-body"><p class="first">Le retcode à utilisé pour la reception de retour éventuel.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Lève:</th><td class="field-body"><p class="first last"><strong>NotConnectedError</strong> – Levé si le socket n’est pas connecté.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><em>opcode</em>, <em>*args</em>, <em>timeout=5</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.execute" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Execute permet l’envoie d’une requette et retourne directement le resultat de celle-ci. Il est recommandé de l’utilisé si votre requette attend un retour de la part du binome</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first last simple">
<li><strong>opcode</strong> – OPCode a utlisé pour la requette.</li>
<li><strong>args</strong> – Arguments à envoyer pour la bonne execution de la requette.</li>
<li><strong>timeout</strong> – Timeout à utiliser pour la reception du resultat de la requette.</li>
<li><strong>kwargs</strong> – Arguments nommés à envoyer pour la bonne execution de la requette.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.get_queue">
<code class="descname">get_queue</code><span class="sig-paren">(</span><em>retcode</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.get_queue" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>get_queue permet de récuperer la <a class="reference external" href="https://docs.python.org/3.6/library/queue.html">Queue</a> qui est associé au retcode indiqué. Peut importe si elle est vide ou non.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>retcode</strong> – Code de la <a class="reference external" href="https://docs.python.org/3.6/library/queue.html">Queue</a> à retourner.</td>
</tr>
<tr class="field-even field"><th class="field-name">Retourne:</th><td class="field-body">Retourne la <a class="reference external" href="https://docs.python.org/3.6/library/queue.html">Queue</a>  qui est associé au retcode indiqué.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.delete_queue">
<code class="descname">delete_queue</code><span class="sig-paren">(</span><em>retcode</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.delete_queue" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Methode pour la suppression de la <a class="reference external" href="https://docs.python.org/3.6/library/queue.html">Queue</a>  associé au retcode indiqué. Dans la conception cette methode consiste à supprimer les données de la <a class="reference external" href="https://docs.python.org/3.6/library/queue.html">Queue</a> uniquement.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>retcode</strong> – Code de la <a class="reference external" href="https://docs.python.org/3.6/library/queue.html">Queue</a> à supprimer.</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Ces methodes sont destiées à une utilisation interne, il est peu recommandé de les utiliser.</p>
</div>
<dl class="method">
<dt id="TCPTalks.sendback">
<code class="descname">sendback</code><span class="sig-paren">(</span><em>retcode</em>, <em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.sendback" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Methode destinée à une utilisation interne. Permet l’envoie du message esclave avec les arguments et le retcode associé à la reponse. Il est possible de définir soit même son retcode mais très peu pratique pour le retrouver chez le binome sans configuration au préalable.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>args</strong> – Arguments a transmettre dans le message esclave.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>message</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.process" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Permet de traités le message reçu. C’est à dire identifier quel type de message (esclave ou maitre) .</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>message</strong> – Message en <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html?highlight=tuples">Tuples</a> recu.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.execinstruction">
<code class="descname">execinstruction</code><span class="sig-paren">(</span><em>opcode</em>, <em>retcode</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.execinstruction" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Cette methode lance l’execution de la fonction associé à l’OPCode et renvoie ce que la fonction retourne après son execution.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first last simple">
<li><strong>opcode</strong> – Opcode de la requette a traiter.</li>
<li><strong>retcode</strong> – RetCode de la requette en cours de traitement.</li>
<li><strong>args</strong> – Arguments à transmettre à la methode lancée.</li>
<li><strong>kwargs</strong> – Arguments nommés à transmettre à la methode lancée.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks.rawsend">
<code class="descname">rawsend</code><span class="sig-paren">(</span><em>rawbytes</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks.rawsend" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Methode permettant l’envoie direct de bytes au binome.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>rawbytes</strong> – Données à transmettre.</td>
</tr>
<tr class="field-even field"><th class="field-name">Lève:</th><td class="field-body"><strong>NotConnectedError</strong> – Levé si le socket n’est pas connecté.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks._serversocket">
<code class="descname">_serversocket</code><span class="sig-paren">(</span><em>port</em>, <em>timeout</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks._serversocket" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Methode privée pour la connexion du socket en tant que serveur.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first simple">
<li><strong>port</strong> – Port à utiliser pour le lancement du serveur.</li>
<li><strong>timeout</strong> – Timeout à utiliser pour la connexion.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Retourne:</th><td class="field-body"><p class="first last">Retourne un object socket utilisable pour la connexion.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks._clientsocket">
<code class="descname">_clientsocket</code><span class="sig-paren">(</span><em>ip</em>, <em>port</em>, <em>timeout</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks._clientsocket" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Methode privée pour la connexion à un serveur avec l’ip et le port.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first last simple">
<li><strong>ip</strong> – Ip du serveur à connecter.</li>
<li><strong>port</strong> – Port à utiliser pour la connexion.</li>
<li><strong>timeout</strong> – Timeout utilisé pour la connexion au serveur.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="TCPTalks._loads">
<code class="descname">_loads</code><span class="sig-paren">(</span><em>rawbytes</em><span class="sig-paren">)</span><a class="headerlink" href="#TCPTalks._loads" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Methode qui permet d’isolé le premier message du rawbytes, ou renvoie une erreure si le rawbytes n’est constitué que d’un message incomplet.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Lève:</th><td class="field-body"><ul class="first last simple">
<li><strong>pickle.UnpicklingError</strong> – Levée si le rawbytes n’est constitué que d’un message incomplet.</li>
<li><strong>AttributeError</strong> – Levée si le rawbytes n’est constitué que d’un message incomplet.</li>
<li><strong>EOFError</strong> – Levée si le rawbytes n’est constitué que d’un message incomplet.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p>..class:: TCPListener(Thread)</p>
<blockquote>
<div><dl class="method">
<dt id="__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>parent</em><span class="sig-paren">)</span><a class="headerlink" href="#__init__" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Constructeur du TCPListener.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>parent</strong> – Object TCPTalks auquel le TCPListener sera rataché</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#run" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Methode principal du Thread, elle permet la reception des messages et l’envoie pour traitement à TCPTalks.</p>
</dd></dl>

</div></blockquote>
</div>
<div class="section" id="utilisation">
<h2>Utilisation<a class="headerlink" href="#utilisation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il faut bien comprendre que dans cette librairie la connexion n’est pas exactement symetrique. Puisque qu’il faut choisir qui sera le serveur et qui sera le client.
Il est donc important de bien choisir les rôles pour une bonne utilisation.</p>
<p>Dans ce petit guide je vous montrerai une utilisation basique de la librairie avec quelques astuces.</p>
<p>Pour etablir une connexion il suffit d’écrire les lignes suivantes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Il est possible d’utiliser cette librairie en interne avec l’IP <code class="docutils literal"><span class="pre">127.0.0.1</span></code>.</p>
</div>
<p>Côté client :</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">TCPTalks</span> <span class="k">import</span> <span class="o">*</span>

<span class="c1">#creation du TCPTalks</span>
<span class="n">tcplink</span> <span class="o">=</span> <span class="n">TCPTalks</span><span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1">#Connexion au client</span>
<span class="n">tcplink</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>
</div>
<p>Côté serveur:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">TCPTalks</span> <span class="k">import</span> <span class="o">*</span>

<span class="c1">#creation du TCPTalks</span>
<span class="n">tcplink</span> <span class="o">=</span> <span class="n">TCPTalks</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1">#Connexion au serveur</span>
<span class="n">tcplink</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>
</div>
<p>Une fois la connexion faite, il n’y a plus de difference dans le fonctionnement de la lib entre serveur et client.</p>
<p>La prochaine étape est d’affecter des methodes ou fonctions à un opcode pour pouvoir repondre à des requettes.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>tcplink.bind(0xFF,``fonction``)
</pre></div>
</div>
<p>Pour la realisation de fonction utilisable par la librairie, il n’y a pas beaucoup de contrainte, puisque le TCPtalks va remplir tous les champs de la fonction avec les données reçu.
Si il manque des arguments dans la requettes la librairie lèvera une erreur chez l’emetteur de cette requette.</p>
<p>Pour retourner des arguments il suffit de les mettres dans le return de la methode. Il est possible d’avoir plusieurs return différents avec un nombre d’arguments differents.</p>
<p>Exemple :</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fonction</span><span class="p">(</span><span class="n">texte</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">texte</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Bien reçu&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Dans cette  exemple, la fonction va quand elle sera apellé par TCPTalks afficher le paramètre recu dans la requette avec l’OPCode qui était associé à cette fonction. Elle va ensuite renvoyer deux variables, un texte et un entier.
Cette exemple reste très basique mais ilustre bien le peut de contraite qu’impose TCPTalks.</p>
<p>Il ne reste plus qu’à lancer l’instruction que nous venons de creer. Pour finir ce petit tutoriel, je vais montrer les deux methodes pour une parfaite execution de la commande.
La première methode qui est la plus simple quand il faut apeller une requette qui attend un retour comme avec la fonctionb que nous avons creer juste au dessus.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">tcplink</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span><span class="s2">&quot;tu me reçois ?&quot;</span><span class="p">)</span>
<span class="c1">#Cette ligne va naturelement renvoyer le tuple (&quot;Bien reçu&quot;,10)</span>
</pre></div>
</div>
<p>La deuxième methode moins recommandée (pour des raisons de gestion d’erreur à distance) consiste à utiliser les deux methodes send et poll.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="c1">#envoie de la requette</span>
<span class="n">retcode</span> <span class="o">=</span> <span class="n">tcplink</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,(</span><span class="s2">&quot;tu me reçois?&quot;</span><span class="p">)</span>

<span class="c1">#reception du rendu de la requette</span>
<span class="n">tcplink</span><span class="o">.</span><span class="n">poll</span><span class="p">(</span><span class="n">retcode</span><span class="p">)</span>
<span class="c1">#Cette ligne affiche naturelement le tuple  (&quot;Bien reçu&quot;,10).</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table des Matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">TCP Talks</a><ul>
<li><a class="reference internal" href="#preambule">Preambule</a></li>
<li><a class="reference internal" href="#api">API</a></li>
<li><a class="reference internal" href="#utilisation">Utilisation</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="SerialUtils.html"
                        title="Chapitre précédent">Serial Utils</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="Components.html"
                        title="Chapitre suivant">Components</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/TCPTalks.rst.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="Components.html" title="Components"
             >suivant</a> |</li>
        <li class="right" >
          <a href="SerialUtils.html" title="Serial Utils"
             >précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">documentation Club Robot 1.0</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, members&#39; Club.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>